<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe - XO Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            max-width: 600px;
            width: 100%;
            padding: 20px;
        }

        .menu, .game-container, .settings-panel, .leaderboard-panel, .history-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.3s ease;
            pointer-events: none;
            position: absolute;
            width: 100%;
            max-width: 500px;
        }

        .menu.active, .game-container.active, .settings-panel.active, .leaderboard-panel.active, .history-panel.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: all;
            position: relative;
        }

        .menu h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .menu p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .menu-button, .back-button, .btn {
            display: block;
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .menu-button:hover, .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .menu-button.secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            padding: 10px 15px;
            font-size: 0.95rem;
        }

        .turn-indicator {
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .turn-indicator.red-turn {
            text-shadow: 0 0 20px #ff6b6b;
        }

        .turn-indicator.blue-turn {
            text-shadow: 0 0 20px #4ecdc4;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 300px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .board.red-active {
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
        }

        .board.blue-active {
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.5);
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell:hover:not(.taken) {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .cell.taken {
            cursor: not-allowed;
        }

        .cell.x {
            color: var(--player1-color, #ff6b6b);
            text-shadow: 2px 2px 4px rgba(255, 107, 107, 0.3);
        }

        .cell.o {
            color: var(--player2-color, #4ecdc4);
            text-shadow: 2px 2px 4px rgba(78, 205, 196, 0.3);
        }

        .cell.winning {
            animation: winningGlow 1s ease-in-out infinite alternate;
            transform: scale(1.1);
        }

        @keyframes winningGlow {
            0% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
                background: rgba(255, 255, 255, 0.9);
            }
            100% {
                box-shadow: 0 0 40px rgba(255, 215, 0, 1);
                background: rgba(255, 255, 255, 1);
            }
        }

        .victory-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px 40px;
            border-radius: 20px;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .victory-message.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .victory-message.red {
            text-shadow: 0 0 30px #ff6b6b;
            border: 3px solid #ff6b6b;
        }

        .victory-message.blue {
            text-shadow: 0 0 30px #4ecdc4;
            border: 3px solid #4ecdc4;
        }

        .victory-message.draw {
            text-shadow: 0 0 30px #ffd700;
            border: 3px solid #ffd700;
        }

        .back-button {
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.95rem;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .ai-thinking {
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .ai-thinking.show {
            opacity: 1;
        }

        .ai-thinking::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        .difficulty-selector {
            margin: 15px 0;
        }

        .difficulty-selector label {
            display: block;
            color: white;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .difficulty-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .difficulty-btn {
            flex: 1;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .difficulty-btn.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border-color: #4ecdc4;
        }

        .leaderboard-list, .history-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .leaderboard-item, .history-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .leaderboard-item:hover, .history-item:hover {
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
        }

        .form-group {
            margin: 15px 0;
            text-align: left;
        }

        .form-group label {
            display: block;
            color: white;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .color-picker {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .menu h1 {
                font-size: 2rem;
            }
            
            .board {
                max-width: 250px;
            }
            
            .cell {
                font-size: 2rem;
            }
            
            .victory-message {
                padding: 20px 25px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="menu active" id="menu">
            <h1>🎮 Tic Tac Toe</h1>
            <p>Choose your game mode</p>
            <button class="menu-button" onclick="startFriendGame()">👥 Play with Friend</button>
            <button class="menu-button" onclick="startAIGame()">🤖 Play with AI (Gemini)</button>
            <button class="menu-button secondary" onclick="showLeaderboard()">🏆 Leaderboard</button>
            <button class="menu-button secondary" onclick="showHistory()">📜 Game History</button>
            <button class="menu-button secondary" onclick="showSettings()">⚙️ Settings</button>
        </div>

        <div class="game-container" id="gameContainer">
            <div class="turn-indicator" id="turnIndicator">Red's Turn (X)</div>
            
            <div class="difficulty-selector" id="difficultySelector" style="display:none;">
                <label>AI Difficulty:</label>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn" onclick="setDifficulty('easy')">Easy</button>
                    <button class="difficulty-btn active" onclick="setDifficulty('medium')">Medium</button>
                    <button class="difficulty-btn" onclick="setDifficulty('hard')">Hard</button>
                </div>
            </div>

            <div class="board" id="board">
                <button class="cell" onclick="makeMove(0)"></button>
                <button class="cell" onclick="makeMove(1)"></button>
                <button class="cell" onclick="makeMove(2)"></button>
                <button class="cell" onclick="makeMove(3)"></button>
                <button class="cell" onclick="makeMove(4)"></button>
                <button class="cell" onclick="makeMove(5)"></button>
                <button class="cell" onclick="makeMove(6)"></button>
                <button class="cell" onclick="makeMove(7)"></button>
                <button class="cell" onclick="makeMove(8)"></button>
            </div>

            <div class="ai-thinking" id="aiThinking">AI is thinking</div>
            <button class="back-button" onclick="backToMenu()">← Back to Menu</button>
        </div>

        <div class="settings-panel" id="settingsPanel">
            <h2 style="color: white; margin-bottom: 20px;">⚙️ Settings</h2>
            <div class="form-group">
                <label>Player 1 Name:</label>
                <input type="text" id="player1Name" placeholder="Player 1" value="Player 1">
            </div>
            <div class="form-group">
                <label>Player 1 Color:</label>
                <div class="color-picker" id="player1ColorPicker">
                    <div class="color-option selected" style="background: #ff6b6b;" onclick="selectColor(1, '#ff6b6b')"></div>
                    <div class="color-option" style="background: #ee5a52;" onclick="selectColor(1, '#ee5a52')"></div>
                    <div class="color-option" style="background: #ff9ff3;" onclick="selectColor(1, '#ff9ff3')"></div>
                    <div class="color-option" style="background: #feca57;" onclick="selectColor(1, '#feca57')"></div>
                </div>
            </div>
            <div class="form-group">
                <label>Player 2 Name:</label>
                <input type="text" id="player2Name" placeholder="Player 2" value="Player 2">
            </div>
            <div class="form-group">
                <label>Player 2 Color:</label>
                <div class="color-picker" id="player2ColorPicker">
                    <div class="color-option selected" style="background: #4ecdc4;" onclick="selectColor(2, '#4ecdc4')"></div>
                    <div class="color-option" style="background: #44a08d;" onclick="selectColor(2, '#44a08d')"></div>
                    <div class="color-option" style="background: #54a0ff;" onclick="selectColor(2, '#54a0ff')"></div>
                    <div class="color-option" style="background: #48dbfb;" onclick="selectColor(2, '#48dbfb')"></div>
                </div>
            </div>
            <button class="btn" onclick="saveSettings()">Save Settings</button>
            <button class="back-button" onclick="backToMenu()">← Back</button>
        </div>

        <div class="leaderboard-panel" id="leaderboardPanel">
            <h2 style="color: white; margin-bottom: 20px;">🏆 Leaderboard</h2>
            <div class="leaderboard-list" id="leaderboardList">
                <p style="color: rgba(255,255,255,0.7);">Loading...</p>
            </div>
            <button class="back-button" onclick="backToMenu()">← Back</button>
        </div>

        <div class="history-panel" id="historyPanel">
            <h2 style="color: white; margin-bottom: 20px;">📜 Game History</h2>
            <div class="history-list" id="historyList">
                <p style="color: rgba(255,255,255,0.7);">Loading...</p>
            </div>
            <button class="back-button" onclick="backToMenu()">← Back</button>
        </div>

        <div class="victory-message" id="victoryMessage"></div>
    </div>

    <script>
        let board = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X';
        let gameMode = '';
        let gameActive = true;
        let isAITurn = false;
        let difficulty = 'medium';
        let gameMoves = [];
        let settings = {
            player1: { name: 'Player 1', color: '#ff6b6b' },
            player2: { name: 'Player 2', color: '#4ecdc4' }
        };

        const menu = document.getElementById('menu');
        const gameContainer = document.getElementById('gameContainer');
        const boardElement = document.getElementById('board');
        const turnIndicator = document.getElementById('turnIndicator');
        const victoryMessage = document.getElementById('victoryMessage');
        const aiThinking = document.getElementById('aiThinking');
        const cells = document.querySelectorAll('.cell');
        const difficultySelector = document.getElementById('difficultySelector');
        const settingsPanel = document.getElementById('settingsPanel');
        const leaderboardPanel = document.getElementById('leaderboardPanel');
        const historyPanel = document.getElementById('historyPanel');

        const winningCombinations = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        const moveSound = new Audio('/sounds/hit.mp3');
        const winSound = new Audio('/sounds/success.mp3');
        const drawSound = new Audio('/sounds/background.mp3');

        loadSettings();

        function playSound(sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Audio play failed:', e));
        }

        function loadSettings() {
            const saved = localStorage.getItem('tictactoe_settings');
            if (saved) {
                settings = JSON.parse(saved);
                document.getElementById('player1Name').value = settings.player1.name;
                document.getElementById('player2Name').value = settings.player2.name;
                updateColorSelection();
            }
            applyColors();
        }

        function applyColors() {
            document.documentElement.style.setProperty('--player1-color', settings.player1.color);
            document.documentElement.style.setProperty('--player2-color', settings.player2.color);
        }

        function selectColor(player, color) {
            const picker = player === 1 ? 'player1ColorPicker' : 'player2ColorPicker';
            document.querySelectorAll(`#${picker} .color-option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.classList.add('selected');
            settings[`player${player}`].color = color;
        }

        function updateColorSelection() {
            document.querySelectorAll('#player1ColorPicker .color-option').forEach(opt => {
                opt.classList.toggle('selected', opt.style.background === settings.player1.color);
            });
            document.querySelectorAll('#player2ColorPicker .color-option').forEach(opt => {
                opt.classList.toggle('selected', opt.style.background === settings.player2.color);
            });
        }

        function saveSettings() {
            settings.player1.name = document.getElementById('player1Name').value || 'Player 1';
            settings.player2.name = document.getElementById('player2Name').value || 'Player 2';
            localStorage.setItem('tictactoe_settings', JSON.stringify(settings));
            applyColors();
            alert('Settings saved!');
        }

        function showPanel(panel) {
            [menu, gameContainer, settingsPanel, leaderboardPanel, historyPanel].forEach(p => {
                p.classList.remove('active');
            });
            panel.classList.add('active');
        }

        function showSettings() {
            showPanel(settingsPanel);
        }

        async function showLeaderboard() {
            showPanel(leaderboardPanel);
            try {
                const res = await fetch('/api/leaderboard');
                const data = await res.json();
                const list = document.getElementById('leaderboardList');
                if (data.length === 0) {
                    list.innerHTML = '<p style="color: rgba(255,255,255,0.7);">No games played yet</p>';
                } else {
                    list.innerHTML = data.map((p, i) => `
                        <div class="leaderboard-item">
                            <span>${i + 1}. ${p.name}</span>
                            <span>W: ${p.wins} L: ${p.losses} D: ${p.draws}</span>
                        </div>
                    `).join('');
                }
            } catch (e) {
                document.getElementById('leaderboardList').innerHTML = '<p style="color: rgba(255,255,255,0.7);">Error loading leaderboard</p>';
            }
        }

        async function showHistory() {
            showPanel(historyPanel);
            try {
                const res = await fetch('/api/game-history');
                const data = await res.json();
                const list = document.getElementById('historyList');
                if (data.length === 0) {
                    list.innerHTML = '<p style="color: rgba(255,255,255,0.7);">No games played yet</p>';
                } else {
                    list.innerHTML = data.map(g => `
                        <div class="history-item" onclick="replayGame(${g.id})">
                            <div>
                                <div>${g.player1Name} vs ${g.player2Name}</div>
                                <div style="font-size: 0.85rem; opacity: 0.7;">${new Date(g.playedAt).toLocaleDateString()}</div>
                            </div>
                            <span>${g.winner || 'Draw'}</span>
                        </div>
                    `).join('');
                }
            } catch (e) {
                document.getElementById('historyList').innerHTML = '<p style="color: rgba(255,255,255,0.7);">Error loading history</p>';
            }
        }

        async function replayGame(id) {
            try {
                const res = await fetch(`/api/game/${id}`);
                const game = await res.json();
                showPanel(gameContainer);
                difficultySelector.style.display = 'none';
                board = [...game.finalBoard];
                gameActive = false;
                cells.forEach((cell, i) => {
                    cell.textContent = board[i];
                    cell.className = 'cell';
                    if (board[i]) {
                        cell.classList.add('taken', board[i].toLowerCase());
                    }
                });
                checkWin();
            } catch (e) {
                alert('Error loading game replay');
            }
        }

        function setDifficulty(level) {
            difficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function startFriendGame() {
            gameMode = 'friend';
            difficultySelector.style.display = 'none';
            initializeGame();
        }

        function startAIGame() {
            gameMode = 'ai';
            difficultySelector.style.display = 'block';
            initializeGame();
        }

        function initializeGame() {
            board = ['', '', '', '', '', '', '', '', ''];
            gameActive = true;
            isAITurn = false;
            gameMoves = [];
            currentPlayer = Math.random() < 0.5 ? 'X' : 'O';
            
            cells.forEach(cell => {
                cell.textContent = '';
                cell.className = 'cell';
            });

            showPanel(gameContainer);
            updateTurnDisplay();

            if (gameMode === 'ai' && currentPlayer === 'X') {
                setTimeout(() => makeAIMove(), 1000);
            }
        }

        function makeMove(index) {
            if (!gameActive || isAITurn || board[index] !== '') return;

            board[index] = currentPlayer;
            cells[index].textContent = currentPlayer;
            cells[index].classList.add('taken', currentPlayer.toLowerCase());
            gameMoves.push({ player: currentPlayer, index, timestamp: Date.now() });
            playSound(moveSound);

            if (checkWin()) {
                handleGameEnd();
                return;
            }

            if (checkDraw()) {
                handleDraw();
                return;
            }

            switchTurns();

            if (gameMode === 'ai' && currentPlayer === 'X') {
                setTimeout(() => makeAIMove(), 800);
            }
        }

        async function makeAIMove() {
            if (!gameActive) return;

            isAITurn = true;
            aiThinking.classList.add('show');

            try {
                const res = await fetch('/api/ai-move', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ board, difficulty })
                });
                const data = await res.json();
                const move = data.move;

                if (move !== undefined && board[move] === '') {
                    board[move] = currentPlayer;
                    cells[move].textContent = currentPlayer;
                    cells[move].classList.add('taken', currentPlayer.toLowerCase());
                    gameMoves.push({ player: currentPlayer, index: move, timestamp: Date.now() });
                    playSound(moveSound);

                    if (checkWin()) {
                        handleGameEnd();
                        return;
                    }

                    if (checkDraw()) {
                        handleDraw();
                        return;
                    }

                    switchTurns();
                }
            } catch (e) {
                console.error('AI move error:', e);
            } finally {
                isAITurn = false;
                aiThinking.classList.remove('show');
            }
        }

        function switchTurns() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updateTurnDisplay();
        }

        function updateTurnDisplay() {
            let playerName;
            if (gameMode === 'ai') {
                playerName = currentPlayer === 'X' ? 'AI' : settings.player2.name;
            } else {
                playerName = currentPlayer === 'X' ? settings.player1.name : settings.player2.name;
            }
            
            turnIndicator.textContent = `${playerName}'s Turn (${currentPlayer})`;
            turnIndicator.className = 'turn-indicator';
            
            if (currentPlayer === 'X') {
                turnIndicator.classList.add('red-turn');
                boardElement.className = 'board red-active';
            } else {
                turnIndicator.classList.add('blue-turn');
                boardElement.className = 'board blue-active';
            }
        }

        function checkWin() {
            for (let combo of winningCombinations) {
                const [a, b, c] = combo;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    cells[a].classList.add('winning');
                    cells[b].classList.add('winning');
                    cells[c].classList.add('winning');
                    return true;
                }
            }
            return false;
        }

        function checkDraw() {
            return board.every(cell => cell !== '');
        }

        async function handleGameEnd() {
            gameActive = false;
            playSound(winSound);
            
            let winnerText = '';
            let messageClass = '';
            let winnerName = '';

            if (gameMode === 'friend') {
                winnerName = currentPlayer === 'X' ? settings.player1.name : settings.player2.name;
                winnerText = currentPlayer === 'X' ? '🔴 ' + winnerName + ' Won!' : '🔵 ' + winnerName + ' Won!';
                messageClass = currentPlayer === 'X' ? 'red' : 'blue';
            } else {
                if (currentPlayer === 'X') {
                    winnerText = '🤖 AI Wins!';
                    winnerName = 'AI';
                    messageClass = 'red';
                } else {
                    winnerText = '🎉 You Win!';
                    winnerName = settings.player2.name;
                    messageClass = 'blue';
                }
            }

            await saveGameData(winnerName);
            showVictoryMessage(winnerText, messageClass);
        }

        async function handleDraw() {
            gameActive = false;
            playSound(drawSound);
            await saveGameData('draw');
            showVictoryMessage('🤝 Draw!', 'draw');
        }

        async function saveGameData(winner) {
            try {
                const gameData = {
                    gameMode,
                    difficulty: gameMode === 'ai' ? difficulty : null,
                    player1Name: gameMode === 'friend' ? settings.player1.name : 'AI',
                    player2Name: gameMode === 'friend' ? settings.player2.name : settings.player2.name,
                    winner: winner === 'draw' ? null : winner,
                    moves: gameMoves,
                    finalBoard: board
                };
                await fetch('/api/save-game', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gameData)
                });
            } catch (e) {
                console.error('Error saving game:', e);
            }
        }

        function showVictoryMessage(text, className) {
            victoryMessage.textContent = text;
            victoryMessage.className = `victory-message ${className}`;
            
            setTimeout(() => {
                victoryMessage.classList.add('show');
            }, 2000);

            setTimeout(() => {
                backToMenu();
            }, 5000);
        }

        function backToMenu() {
            victoryMessage.classList.remove('show');
            [gameContainer, settingsPanel, leaderboardPanel, historyPanel].forEach(p => {
                p.classList.remove('active');
            });
            
            setTimeout(() => {
                menu.classList.add('active');
                boardElement.className = 'board';
                cells.forEach(cell => cell.classList.remove('winning'));
            }, 300);
        }
    </script>
</body>
</html>
